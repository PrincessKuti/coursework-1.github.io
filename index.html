<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coursework 1 - Lessons</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>

<body class="bg-gray-100">

    <div id="app" class="px-6 mx-auto max-w-full lg:px-12 py-4">

        <div class="flex justify-between mb-8">
            <div class="flex space-x-4">
                <label v-for="option in sortOptions" :key="option" :for="`sortAttribute${option}`"
                    class="inline-flex items-center space-x-2 cursor-pointer text-lg">
                    <input type="radio" :id="`sortAttribute${option}`" v-model="sortBy" :value="option"
                     class="form-radio text-blue-500 focus:ring-2 focus:ring-blue-300">
                    <span>{{ capitalize(option) }}</span>
                </label>
            </div>
            <div class="flex space-x-4">
                <label v-for="order in orders" :key="order.value" :for="`sortOrder${order.value}`"
                    class="inline-flex items-center space-x-2 cursor-pointer text-lg">
                    <input type="radio" :id="`sortOrder${order.value}`" v-model="orderBy" :value="order.value"
                     class="form-radio text-blue-500 focus:ring-2 focus:ring-blue-300">
                    <span>{{ order.text }}</span>
                </label>
            </div>

            <!-- "Shopping Cart" button -->
            <button @click="toggleCart" :disabled="shoppingCart.length === 0"
                class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 focus:outline-none focus:ring focus:border-blue-300">
                {{ showCart ? "Hide Cart" : "Show Cart" }}
            </button>
        </div>

        <!-- Lessons List -->
        <div v-if="!showCart">
            <div id="lessons-list" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-8">
                <div v-for="lesson in sortedLessons" :key="lesson.id"
                    class="bg-white rounded-lg shadow-md overflow-hidden p-4 border-l-4 border-blue-500 mb-4">
                    <img :src="`./imgs/${lesson.image}`" :alt="lesson.subject"
                        class="w-full h-48 object-cover object-center mb-4">
                    <h2 class="text-lg font-semibold mb-2 text-blue-500"><strong>Subject:</strong> {{ lesson.subject }}
                    </h2>
                    <p class="text-gray-600 mb-2"><strong>Location:</strong> {{ lesson.location }}</p>
                    <p class="text-gray-800"><strong>Price:</strong> Â£{{ lesson.price }}</p>
                    <p class="text-gray-600"><strong>Spaces:</strong> {{ lesson.spaces }}</p>

                    <!-- "Add to Cart" button -->
                    <button @click="addToCart(lesson)" :disabled="lesson.spaces === 0"
                        class="mt-2 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 focus:outline-none focus:ring focus:border-blue-300 disabled:opacity-50">
                        Add to Cart
                    </button>
                </div>
            </div>
        </div>

        <!-- Shopping Cart -->
        <div v-if="showCart" class="mt-8">
            <h2 class="text-2xl font-semibold mb-4">Shopping Cart</h2>
            <ul>
                <li v-for="cartItem in shoppingCart" :key="cartItem.id">
                    {{ cartItem.subject }} - {{ cartItem.spaces }} spaces
                    <button @click="removeFromCart(cartItem)">Remove</button>
                </li>
            </ul>
        </div>
    </div>

    <script src="/lessons.js"></script>
    <script>
        const app = new Vue({
            el: '#app',
            data: {
                lessons,
                sortBy: 'subject',
                orderBy: 'asc',
                sortOptions: ["subject", "location", "price", "spaces"],
                orders: [
                    {
                        text: "Ascending",
                        value: "asc",
                    },
                    {
                        text: "Descending",
                        value: "desc",
                    },
                ],
                shoppingCart: [],
                showCart: false,
            },
            computed: {
                sortedLessons() {
                    if (this.lessons.length <= 0) return [];

                    const sortOrder = this.orderBy === "asc" ? 1 : -1;

                    return this.lessons.slice().sort((a, b) => {
                        const aValue = this.getSortValue(a);
                        const bValue = this.getSortValue(b);

                        return sortOrder * this.compareValues(aValue, bValue);
                    });
                },
            },
            methods: {
                getSortValue(lesson) {
                    switch (this.sortBy) {
                        case "subject":
                        case "location":
                            return lesson[this.sortBy].toLowerCase();
                        case "price":
                        case "availability":
                            return lesson[this.sortBy];
                        default:
                            return 0;
                    }
                },
                compareValues(a, b) {
                    return a > b ? 1 : a < b ? -1 : 0;
                },
                capitalize(str) {
                    return str.charAt(0).toUpperCase() + str.slice(1);
                },
                addToCart(lesson) {
                    if (lesson.spaces > 0) {
                        // Add the lesson to the cart
                        this.shoppingCart.push({
                            id: lesson.id,
                            subject: lesson.subject,
                            spaces: 1,
                        });

                        // Reduce the remaining space by one
                        lesson.spaces -= 1;
                    }
                },
                toggleCart() {
                    // Toggle the visibility of the shopping cart
                    this.showCart = !this.showCart;
                },
                removeFromCart(cartItem) {
                    // Remove from cart logic
                    const index = this.shoppingCart.findIndex(item => item.id === cartItem.id);
                    if (index !== -1) {
                        this.shoppingCart.splice(index, 1);
                    }

                    // Add the removed lesson back to the lesson list
                    const lessonIndex = this.lessons.findIndex(lesson => lesson.id === cartItem.id);
                    if (lessonIndex !== -1) {
                        this.lessons[lessonIndex].spaces += cartItem.spaces;
                    }
                },
            },
        });
    </script>
</body>

</html>